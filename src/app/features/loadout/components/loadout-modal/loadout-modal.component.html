<div class="dialog-container">
  <div class="header">
    <h2 mat-dialog-title>
      <mat-icon>inventory_2</mat-icon>
      <span>{{ data.setup.name }}</span>
    </h2>
    <!-- Desktop Actions -->
    <div class="header-actions desktop-actions">
      <button mat-icon-button 
              [color]="hasLiked ? 'warn' : ''" 
              (click)="toggleLike()"
              [matTooltip]="(isLoggedIn$ | async) ? (hasLiked ? 'Unlike' : 'Like') : 'Sign in to like'"
              [disabled]="(isLoggedIn$ | async) === false">
        <mat-icon>{{ hasLiked ? 'favorite' : 'favorite_border' }}</mat-icon>
      </button>
      <button mat-icon-button (click)="copyLoadout()" matTooltip="Copy Loadout">
        <mat-icon>content_copy</mat-icon>
      </button>
      <button *ngIf="isOwner"
              mat-icon-button
              matTooltip="Delete Loadout"
              color="warn"
              (click)="deleteLoadout()">
        <mat-icon>delete</mat-icon>
      </button>
      <button mat-icon-button mat-dialog-close matTooltip="Close">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <!-- Mobile Actions -->
    <div class="header-actions mobile-actions">
      <button mat-icon-button [matMenuTriggerFor]="menu">
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item
                (click)="toggleLike()"
                [disabled]="(isLoggedIn$ | async) === false">
          <mat-icon [color]="hasLiked ? 'warn' : ''">{{ hasLiked ? 'favorite' : 'favorite_border' }}</mat-icon>
          <span [class.warn-text]="hasLiked">{{ hasLiked ? 'Unlike' : 'Like' }}</span>
        </button>
        <button mat-menu-item (click)="copyLoadout()">
          <mat-icon>content_copy</mat-icon>
          <span>Copy Loadout</span>
        </button>
        <button mat-menu-item *ngIf="isOwner" (click)="deleteLoadout()">
          <mat-icon color="warn">delete</mat-icon>
          <span class="warn-text">Delete Loadout</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item mat-dialog-close>
          <mat-icon>close</mat-icon>
          <span>Close</span>
        </button>
      </mat-menu>
    </div>
  </div>

  <div class="content-wrapper">
    <div class="preview-section">
      <div class="preview-header">
        <div class="preview-meta" *ngIf="data.tags?.length || data.category !== 'Custom'">
          <mat-chip-set>
            <mat-chip color="primary" highlighted>{{ data.category }}</mat-chip>
            <mat-chip *ngFor="let tag of data.tags">{{ tag }}</mat-chip>
          </mat-chip-set>
        </div>
      </div>
      
      <div class="preview-content">
        <div class="preview-grid">
          <!-- Equipment Section -->
          <div class="section">
            <div class="section-title">
              <mat-icon>accessibility</mat-icon>
              Equipped Items
            </div>
            <app-equipment-slots
              [equipment]="data.setup.eq"
              [spellbookId]="data.setup.sb ?? 0">
            </app-equipment-slots>
          </div>

          <!-- Inventory Section -->
          <div class="section">
            <div class="section-title">
              <mat-icon>grid_view</mat-icon>
              Storage Items
            </div>
            <div class="inventory-container">
              <div class="inventory-wrapper">
                <app-inventory-grid
                  [items]="data.setup.inv"
                  [layout]="data.layout ?? []">
                </app-inventory-grid>
              </div>
              <app-rune-pouch
                *ngIf="data.setup.rp?.length"
                [runes]="data.setup.rp || []">
              </app-rune-pouch>
            </div>
          </div>
        </div>

        <!-- Additional Items Section -->
        <div class="section" *ngIf="getFilteredItems()?.length">
          <div class="section-title">
            <mat-icon>filter_list</mat-icon>
            Additional Items
          </div>
          <div class="filtered-items">
            <div class="item" *ngFor="let item of getFilteredItems()">
              <img [src]="getItemImageUrl(item.id)" [alt]="getItemName(item.id)">
              <div class="item-tooltip">{{ getItemName(item.id) }}</div>
            </div>
          </div>
        </div>

        <!-- Notes Section -->
        <div class="section notes-section" *ngIf="data.setup.notes">
          <div class="section-title">
            <mat-icon>notes</mat-icon>
            Notes
          </div>
          <div class="notes-content">{{ data.setup.notes }}</div>
        </div>

        <!-- Stats Section -->
        <div class="section stats-section">
          <div class="stats">
            <span class="stat">
              <mat-icon>schedule</mat-icon>
              {{ data.createdAt | firebaseDate }}
            </span>
            <span class="stat">
              <mat-icon>favorite</mat-icon>
              {{ data.likes || 0 }} {{ (data.likes === 1) ? 'like' : 'likes' }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Close</button>
  </mat-dialog-actions>
</div> 